<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>AKHUENO PROJECT ‚Äî –ù–ê–•–£–ô ‚ù§</title>
<script src="https://unpkg.com/@tonconnect/sdk@2/dist/tonconnect-sdk.min.js"></script>
<style>:root{--bg:#000;--fg:#e0e0e0;--accent:#f00;--secondary:#0041f0;--card-bg:rgba(10,10,15,.9);--era-color:#00aaff;--date-color:#66b2ff;--shadow:rgba(240,0,0,.3)}.light{--bg:#fff;--fg:#222;--accent:#b30000;--secondary:#0033cc;--card-bg:rgba(250,250,255,.95);--era-color:#0055cc;--date-color:#0077dd;--shadow:rgba(179,0,0,.2)}*{margin:0;padding:0;box-sizing:border-box;font-family:system-ui,-apple-system,'Segoe UI',sans-serif;transition:background-color .4s,color .4s}body{background:var(--bg);color:var(--fg);min-height:100vh;padding:20px;position:relative}.container{max-width:900px;margin:0 auto;padding:40px 20px}.theme-toggle{position:absolute;top:20px;right:20px;width:50px;height:26px;background:var(--bg);border:2px solid var(--accent);border-radius:13px;cursor:pointer;display:flex;align-items:center;padding:2px;z-index:100}.toggle-thumb{width:20px;height:20px;background:var(--accent);border-radius:50%;transition:transform .3s}.light .toggle-thumb{transform:translateX(22px);background:var(--secondary)}.logo-wrapper{display:block;width:160px;height:160px;margin:0 auto 20px;animation:floating 6s ease-in-out infinite;cursor:pointer}.logo-wrapper:hover{transform:scale(1.05);animation:none}.logo{width:100%;height:100%;border:3px solid var(--secondary);border-radius:50%;display:flex;align-items:center;justify-content:center;box-shadow:0 0 25px rgba(240,0,0,.6);overflow:hidden}.logo img{width:90%;height:90%;object-fit:contain}@keyframes floating{0%,100%{transform:translateY(0)}50%{transform:translateY(-20px)}}h1{font-size:2.4rem;font-weight:800;color:var(--accent);text-align:center;margin:10px 0}.tagline{font-size:1.05rem;color:var(--fg);opacity:.8;font-style:italic;text-align:center;margin:10px 0 30px}.wallet-info{text-align:center;margin:20px 0 30px;opacity:0;height:0;overflow:hidden;transition:all .5s}.wallet-info.active{opacity:1;height:auto}.wallet-address{font-family:monospace;font-size:1rem;color:var(--secondary);background:rgba(0,65,240,.15);padding:6px 12px;border-radius:8px;display:inline-block;margin:8px 0;word-break:break-all}.token-balance{font-size:1.2rem;font-weight:bold;color:var(--accent);margin-top:8px}.nav-buttons{text-align:center;margin:30px 0}.nav-btn{background:linear-gradient(45deg,var(--accent),#ff4d4d);color:#fff;border:none;padding:12px 24px;border-radius:50px;font-weight:bold;font-size:1rem;cursor:pointer;margin:0 10px;box-shadow:0 0 15px rgba(255,0,0,.5)}.section{display:none}.section.active{display:block;animation:fadeIn .5s}@keyframes fadeIn{from{opacity:0}to{opacity:1}}.roadmap{margin-top:30px}.era{margin:40px 0 30px}.era-title{font-size:1.3rem;font-weight:bold;color:var(--era-color);text-align:center;margin-bottom:20px}.milestone{background:rgba(30,30,40,.6);border-left:4px solid var(--accent);padding:20px;margin:15px 0;border-radius:12px;opacity:0;transform:translateY(20px);animation:slideIn .5s forwards}.light .milestone{background:rgba(240,240,250,.7)}.milestone:nth-child(n){animation-delay:calc(.1s*var(--i))}@keyframes slideIn{to{opacity:1;transform:translateY(0)}}.milestone-title{font-size:1.1rem;font-weight:600;color:var(--fg);margin-bottom:8px}.milestone-date{font-size:.9rem;color:var(--date-color);margin-bottom:10px}.milestone-desc{font-size:.95rem;line-height:1.5;color:var(--fg);opacity:.9}.end-note{text-align:center;margin-top:50px;font-size:1.2rem;color:var(--accent)}.footer{text-align:center;color:var(--fg);opacity:.7;font-size:.95rem;margin-top:50px;padding-top:20px;border-top:1px solid rgba(255,255,255,.08)}.error-message{position:fixed;top:20px;left:50%;transform:translateX(-50%);background:#ff3333;color:#fff;padding:12px 24px;border-radius:8px;z-index:1000;display:none;text-align:center;max-width:90%;box-shadow:0 4px 12px rgba(255,0,0,.3)}@media(max-width:768px){.nav-btn{display:block;margin:10px auto;width:80%}h1{font-size:2rem}.logo-wrapper{width:130px;height:130px}@keyframes floating{50%{transform:translateY(-15px)}}.error-message{top:10px;padding:10px 16px;font-size:.9rem}}</style>
</head>
<body>
<div class="error-message" id="errorMessage"></div>
<div class="theme-toggle" id="themeToggle"><div class="toggle-thumb"></div></div>
<div class="container">
<div id="home" class="section active">
<div class="logo-wrapper" id="logoClickable"><div class="logo"><img src="Logo.png" alt="Akhueno Project Logo" onerror="this.onerror=null;this.src='https://via.placeholder.com/160x160/0041f0/ffffff?text=AKHUENO'"></div></div>
<div class="wallet-info" id="walletInfo"><div class="wallet-address" id="walletAddress"></div><div class="token-balance" id="tokenBalance">–ó–∞–≥—Ä—É–∑–∫–∞...</div></div>
<h1>AKHUENO PROJECT</h1>
<p class="tagline">–ù–æ–≤–∞—è –≤–µ—Ö–∞ –≤ —Å–æ—Ü–∏–∞–ª—å–Ω–æ-—ç–∫–æ–Ω–æ–º–∏—á–µ—Å–∫–∏—Ö –æ—Ç–Ω–æ—à–µ–Ω–∏—è—Ö –º–µ–∂–¥—É –ª—é–¥—å–º–∏. –ò–ª–∏ –Ω–µ—Ç. –ù–æ –Ω–∞—Ö—É–π ‚ù§</p>
<div class="nav-buttons"><button class="nav-btn" onclick="showSection('roadmap')">–î–æ—Ä–æ–∂–Ω–∞—è –∫–∞—Ä—Ç–∞ –ù–∞—Ö—É–π‚ô•Ô∏è</button></div>
<div class="footer"><p>üîÆ –ß–¢–û –ë–£–î–ï–¢ –î–ê–õ–¨–®–ï?</p><p>–•—É–π –∑–Ω–∞–µ—Ç, –Ω–∞—Ö—É–π ‚ù§</p></div>
</div>
<div id="roadmap" class="section">
<h1 style="text-align:center;margin-bottom:30px">üöÄ NAKHUY ROADMAP 2124 EDITION</h1>
<p style="text-align:center;opacity:.8;margin-bottom:40px">(—Å–æ—Å—Ç–∞–≤–ª–µ–Ω–æ –ø—Ä–∏ –ø–æ–ª–Ω–æ–π –ª—É–Ω–µ, –Ω–∞—Ö—É–π ‚ù§)</p>
<div class="roadmap">
<div class="era"><div class="era-title">üåë 2025‚Äì2030: –≠–ü–û–•–ê –•–ê–û–¢–ò–ß–ù–û–ì–û –°–¢–ê–†–¢–ê</div>
<div class="milestone" style="--i:1"><div class="milestone-title">ü™ô –õ–∏—Å—Ç–∏–Ω–≥ –Ω–∞ Blum</div><div class="milestone-date">01.06.2025 13:57+3 UTC</div><div class="milestone-desc">–ù–∞–∫–æ–Ω–µ—Ü-—Ç–æ –≤—ã —Å–º–æ–∂–µ—Ç–µ –∫—É–ø–∏—Ç—å –Ω–∞—Å –∑–∞ —Å–≤–æ–∏ –∫—Ä–æ–≤–Ω—ã–µ, —Å—É–∫–∞, –Ω–∞—Ö—É–π ‚ù§. –ü–µ—Ä–≤—ã–µ 15 –º–∏–Ω—É—Ç ‚Äî —Ç–æ–ª—å–∫–æ –¥–ª—è —Ç–µ—Ö, –∫—Ç–æ –ø—Ä–æ—Å–Ω—É–ª—Å—è. –û—Å—Ç–∞–ª—å–Ω—ã–µ –æ–ø–æ–∑–¥–∞–ª–∏ –Ω–∞ –≤–µ—á–µ—Ä–∏–Ω–∫—É.</div></div>
<div class="milestone" style="--i:2"><div class="milestone-title">üîÆ –ê—Å—Ç—Ä–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —Ä–∞–∑–¥–µ–ª "Candlesticks vs –ì–æ—Ä–æ—Å–∫–æ–ø—ã"</div><div class="milestone-date">Q3 2025</div><div class="milestone-desc">–ö–∞–∂–¥—ã–π –¥–µ–Ω—å –Ω–æ–≤—ã–π –ø—Ä–æ–≥–Ω–æ–∑: '–ï—Å–ª–∏ –Æ–ø–∏—Ç–µ—Ä –≤ 3-–º –¥–æ–º–µ ‚Äî –∂–¥–∏ –¥–∞–º–ø–∞'. –ê—Å—Ç—Ä–æ–±–æ—Ç—ã –±—É–¥—É—Ç —Å–ª–∞—Ç—å –≤–∞–º –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ —Å–∏–≥–Ω–∞–ª—ã –Ω–∞ –ø–æ–∫—É–ø–∫—É/–ø—Ä–æ–¥–∞–∂—É, –æ—Å–Ω–æ–≤–∞–Ω–Ω—ã–µ –Ω–∞ —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–∏ –∑–≤–µ–∑–¥. Mercury in retrograde? HODL, –Ω–∞—Ö—É–π ‚ù§</div></div>
<div class="milestone" style="--i:3"><div class="milestone-title">üè´ Hakhuy Academy</div><div class="milestone-date">2030, +/- 5 –ª–µ—Ç</div><div class="milestone-desc">–ë—É–¥–µ–º —É—á–∏—Ç—å –≤–∞—Å, –∫–∞–∫ –Ω–µ –ø–æ—Ç–µ—Ä—è—Ç—å –≤—Å–µ –¥–µ–Ω—å–≥–∏ –≤ –∫—Ä–∏–ø—Ç–µ. –ü–µ—Ä–≤—ã–π –∫—É—Ä—Å: '–ö–∞–∫ –¥–µ–ª–∞—Ç—å –≤–∏–¥, —á—Ç–æ —Ç—ã –ø–æ–Ω–∏–º–∞–µ—à—å –≤ –±–ª–æ–∫—á–µ–π–Ω–µ'. –ü—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª–∏ ‚Äî –∞–Ω–æ–Ω–∏–º–Ω—ã–µ —Ç—Ä–µ–π–¥–µ—Ä—ã —Å 10+ –≥–æ–¥–∞–º–∏ –æ–ø—ã—Ç–∞ (–≤ —É–±—ã—Ç–∫–∞—Ö).</div></div></div>
<div class="era"><div class="era-title">üåò 2031‚Äì2050: –≠–ü–û–•–ê –¢–ï–•–ù–û–õ–û–ì–ò–ß–ï–°–ö–û–ì–û –ë–ï–ó–£–ú–ò–Ø</div>
<div class="milestone" style="--i:4"><div class="milestone-title">ü§ñ –ú–∞—Ä–∫–µ—Ç–∏–Ω–≥–æ–≤—ã–π Mini-App 'SpamBot 3000'</div><div class="milestone-date">2032</div><div class="milestone-desc">–≠—Ç–æ—Ç –±–æ—Ç –±—É–¥–µ—Ç —Å–ª–∞—Ç—å –≤–∞–º 150 —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –≤ –¥–µ–Ω—å. –ü—Ä–æ—Å–Ω—É–ª—Å—è? –ù–∞—Ö—É–π ‚ù§, –≤–æ—Ç —Ç–µ–±–µ —Ä–µ–∫–ª–∞–º–∞. –õ–µ–≥ —Å–ø–∞—Ç—å? –ù–∞—Ö—É–π ‚ù§, –≤–æ—Ç —Ç–µ–±—è NFT. –û—Ç–ø–∏—à–µ—à—å—Å—è ‚Äî –±–∞–Ω, –Ω–∞—Ö—É–π.</div></div>
<div class="milestone" style="--i:5"><div class="milestone-title">‚öñ –°–º–∞—Ä—Ç-–∫–æ–Ω—Ç—Ä–∞–∫—Ç 'Nakhuy Democracy'</div><div class="milestone-date">2035</div><div class="milestone-desc">–ì–æ–ª–æ—Å–æ–≤–∞–Ω–∏–µ –∑–∞ —Ç–æ, –∫—É–¥–∞ –¥–≤–∏–≥–∞—Ç—å—Å—è –¥–∞–ª—å—à–µ. –í–∞—Ä–∏–∞–Ω—Ç—ã: –∞) –≤—Å—ë –ø—Ä–æ–¥–∞—Ç—å; –±) HODL; –≤) –∑–∞–ø—É—Å—Ç–∏—Ç—å —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—É—é —Å—Ç—Ä–∞–Ω—É. –í—ã–±–∏—Ä–∞–π—Ç–µ, –ø—Å–∏—Ö–∏, –Ω–∞—Ö—É–π ‚ù§</div></div>
<div class="milestone" style="--i:6"><div class="milestone-title">üé® NFT 'Hakhuy OG'</div><div class="milestone-date">2040</div><div class="milestone-desc">10 000 —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –ø–∏–∫—Å–µ–ª—å–Ω—ã—Ö –∞—Ä—Ç–æ–≤. –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç—å: –æ–Ω–∏ –±—É–¥—É—Ç –¥–æ—Ä–æ–∂–∞—Ç—å —Ç–æ–ª—å–∫–æ –≤–æ –≤—Ä–µ–º—è —Å–æ–ª–Ω–µ—á–Ω—ã—Ö –∑–∞—Ç–º–µ–Ω–∏–π. –ì–∞—Ä–∞–Ω—Ç–∏—è: 100 –ª–µ—Ç –∏–ª–∏ –≤–∞—à–∏ –¥–µ–Ω—å–≥–∏ –Ω–∞–∑–∞–¥ (–Ω–µ—Ç).</div></div></div>
<div class="era"><div class="era-title">üåó 2051‚Äì2080: –≠–ü–û–•–ê –ì–õ–û–ë–ê–õ–¨–ù–û–ì–û –î–û–ú–ò–ù–ò–†–û–í–ê–ù–ò–Ø</div>
<div class="milestone" style="--i:7"><div class="milestone-title">üí∏ Telegram Wallet Integration</div><div class="milestone-date">2055</div><div class="milestone-desc">–ü–æ–ø–æ–ª–Ω—è–π –±–∞–ª–∞–Ω—Å, –ø—Ä–æ—Å—Ç–æ –Ω–∞–ø–∏—Å–∞–≤ '–¥–∞–π –¥–µ–Ω–µ–≥' –≤ –ª–∏—á–∫—É –±–æ—Ç—É. –ù–µ —Å—Ä–∞–±–æ—Ç–∞–ª–æ? –ù–∞—Ö—É–π ‚ù§, –ø–æ–ø—Ä–æ–±—É–π –µ—â—ë —Ä–∞–∑.</div></div>
<div class="milestone" style="--i:8"><div class="milestone-title">ü§ù –ü–∞—Ä—Ç–Ω—ë—Ä—Å—Ç–≤–æ —Å TON Foundation</div><div class="milestone-date">2060</div><div class="milestone-desc">TON –∫ —Ç–æ–º—É –≤—Ä–µ–º–µ–Ω–∏ –∫—É–ø–∏—Ç Google, —Ç–∞–∫ —á—Ç–æ –º—ã –±—É–¥–µ–º –≤–µ–∑–¥–µ. –ü–æ–∏—Å–∫ '–∫–∞–∫ —Ä–∞–∑–±–æ–≥–∞—Ç–µ—Ç—å' –±—É–¥–µ—Ç —Å—Ä–∞–∑—É –≤–µ—Å—Ç–∏ –Ω–∞ –Ω–∞—à —Å–∞–π—Ç, –Ω–∞—Ö—É–π ‚ù§</div></div>
<div class="milestone" style="--i:9"><div class="milestone-title">üí∞ –ì—Ä–∞–Ω—Ç—ã –¥–ª—è –ø—Å–∏—Ö–æ–≤-—Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤</div><div class="milestone-date">2065</div><div class="milestone-desc">–í—ã–¥–µ–ª–∏–º $1 000 000 —Ç–µ–º, –∫—Ç–æ –ø—Ä–∏–¥—É–º–∞–µ—Ç, –∫–∞–∫ –∑–∞–ø—É—Å—Ç–∏—Ç—å –±–ª–æ–∫—á–µ–π–Ω –Ω–∞ Nokia 3310. –ù–∞–≥—Ä–∞–¥–∞: –≤–µ—á–Ω–∞—è —Å–ª–∞–≤–∞ –∏ 0,1% –æ—Ç –ø—Ä–æ–µ–∫—Ç–∞.</div></div></div>
<div class="era"><div class="era-title">üåñ 2081‚Äì2100: –≠–ü–û–•–ê –ö–û–°–ú–ò–ß–ï–°–ö–û–ì–û –ë–£–î–£–©–ï–ì–û</div>
<div class="milestone" style="--i:10"><div class="milestone-title">üöÄ Staking-–ø—É–ª—ã –Ω–∞ –ú–∞—Ä—Å–µ</div><div class="milestone-date">2085</div><div class="milestone-desc">–ü–µ—Ä–≤—ã–µ –ø—É–ª—ã –∑–∞ –ø—Ä–µ–¥–µ–ª–∞–º–∏ –ó–µ–º–ª–∏. APY 1000%, –ø–æ—Ç–æ–º—É —á—Ç–æ –Ω–∞ –ú–∞—Ä—Å–µ –Ω–µ—Ç –Ω–∞–ª–æ–≥–æ–≤ (–ø–æ–∫–∞ —á—Ç–æ).</div></div>
<div class="milestone" style="--i:11"><div class="milestone-title">üëë DAO 'Nakhuy Governance'</div><div class="milestone-date">2090</div><div class="milestone-desc">–¢–µ–ø–µ—Ä—å —Å–æ–æ–±—â–µ—Å—Ç–≤–æ –º–æ–∂–µ—Ç –≥–æ–ª–æ—Å–æ–≤–∞—Ç—å –∑–∞ —Ç–∞–∫–∏–µ –≤–∞–∂–Ω—ã–µ –≤–µ—â–∏, –∫–∞–∫ —Ü–≤–µ—Ç –ª–æ–≥–æ—Ç–∏–ø–∞ –∏–ª–∏ –∫–∞–∫–æ–π –º–µ–º –∑–∞–ø—É—Å—Ç–∏—Ç—å —Å–ª–µ–¥—É—é—â–∏–º. –í–ª–∞—Å—Ç—å ‚Äî –Ω–∞—Ä–æ–¥—É, –Ω–∞—Ö—É–π ‚ù§</div></div>
<div class="milestone" style="--i:12"><div class="milestone-title">üåâ –ö—Ä–æ—Å—Å-—á–µ–π–Ω –º–æ—Å—Ç –ó–µ–º–ª—è-–ú–∞—Ä—Å</div><div class="milestone-date">2095</div><div class="milestone-desc">–ü–µ—Ä–µ–≤–æ–¥–∏—Ç–µ —Ç–æ–∫–µ–Ω—ã –º–µ–∂–¥—É –ø–ª–∞–Ω–µ—Ç–∞–º–∏ –±–µ–∑ –∫–æ–º–∏—Å—Å–∏–π (–∫–æ–º–∏—Å—Å–∏–∏ –≤—Å—ë –∂–µ –±—É–¥—É—Ç, –Ω–∞—Ö—É–π ‚ù§).</div></div></div>
<div class="era"><div class="era-title">üåï 2101‚Äì2124: –≠–ü–û–•–ê –õ–ï–ì–ï–ù–î</div>
<div class="milestone" style="--i:13"><div class="milestone-title">üé™ –û—Ñ—Ñ–ª–∞–π–Ω-–º–∏—Ç–∞–ø '–ê—Ö—É–µ–ª–∏?'</div><div class="milestone-date">2110</div><div class="milestone-desc">–°–æ–±–µ—Ä—ë–º—Å—è –Ω–∞ –ú–∞—Ä—Å–µ, —á—Ç–æ–±—ã –æ–±—Å—É–¥–∏—Ç—å, –∫–∞–∫ –º—ã –¥–æ —Ç–∞–∫–æ–≥–æ –¥–æ–∫–∞—Ç–∏–ª–∏—Å—å. –í—Ö–æ–¥ ‚Äî 1 ETH –∏–ª–∏ 10 000 NAKHUY.</div></div>
<div class="milestone" style="--i:14"><div class="milestone-title">üë• –†–µ—Ñ–µ—Ä–∞–ª–∫–∞ '–ü—Ä–∏–≤–µ–¥–∏ –∏–Ω–æ–ø–ª–∞–Ω–µ—Ç—è–Ω–∏–Ω–∞'</div><div class="milestone-date">2115</div><div class="milestone-desc">–ó–∞ –∫–∞–∂–¥–æ–≥–æ –ø—Ä–∏–≤–µ–¥—ë–Ω–Ω–æ–≥–æ –º–∞—Ä—Å–∏–∞–Ω–∏–Ω–∞ ‚Äî –±–æ–Ω—É—Å–Ω—ã–µ —Ç–æ–∫–µ–Ω—ã. –û–Ω–∏ –≤—Å—ë —Ä–∞–≤–Ω–æ –Ω–µ –ø–æ–π–º—É—Ç, —á—Ç–æ —ç—Ç–æ, –Ω–∞—Ö—É–π ‚ù§</div></div>
<div class="milestone" style="--i:15"><div class="milestone-title">üíé –õ–∏—Å—Ç–∏–Ω–≥ –Ω–∞ Intergalactic Exchange</div><div class="milestone-date">2124</div><div class="milestone-desc">–ù–∞—Å –¥–æ–±–∞–≤—è—Ç –Ω–∞ –ø–µ—Ä–≤—É—é –º–µ–∂–≥–∞–ª–∞–∫—Ç–∏—á–µ—Å–∫—É—é –±–∏—Ä–∂—É. –ö—É—Ä—Å: 1 NAKHUY = 1 –∫—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç–∞ –∫–∞–∫–æ–π-—Ç–æ –¥–∞–ª—ë–∫–æ–π-–¥–∞–ª—ë–∫–æ–π –≥–∞–ª–∞–∫—Ç–∏–∫–∏.</div></div></div>
</div>
<div class="end-note">‚Üí ‚àû<br><br>–•—É–π –∑–Ω–∞–µ—Ç, –Ω–∞—Ö—É–π ‚ù§</div>
<div class="nav-buttons" style="margin-top:40px"><button class="nav-btn" onclick="showSection('home')">‚Üê –ù–∞–∑–∞–¥ –Ω–∞ –≥–ª–∞–≤–Ω—É—é</button></div>
</div>
</div>
<script>
const JETTON_MASTER = 'EQA6usPqmsa9I2QHrDUTW_c6xj0v6WPwffyW9uXiwjKBLwBX';
const TON_CENTER_API = 'https://toncenter.com/api/v2/jsonRPC';

const logoClickable = document.getElementById('logoClickable');
const walletInfo = document.getElementById('walletInfo');
const walletAddressEl = document.getElementById('walletAddress');
const tokenBalanceEl = document.getElementById('tokenBalance');
const errorMessageEl = document.getElementById('errorMessage');

let tonClient = null;
let userAddress = null;

function showError(message) {
    errorMessageEl.textContent = message;
    errorMessageEl.style.display = 'block';
    setTimeout(() => {
        errorMessageEl.style.display = 'none';
    }, 5000);
}

document.getElementById('themeToggle').addEventListener('click', () => {
    document.body.classList.toggle('light');
    localStorage.setItem('theme', document.body.classList.contains('light') ? 'light' : 'dark');
});

if (localStorage.getItem('theme') === 'light') {
    document.body.classList.add('light');
}

function showSection(sectionId) {
    document.querySelectorAll('.section').forEach(el => el.classList.remove('active'));
    document.getElementById(sectionId).classList.add('active');
    window.scrollTo(0, 0);
}

async function initializeTonConnect() {
    try {
        if (tonClient && tonClient.wallet) return;

        tonClient = new TonConnect({
            manifestUrl: 'https://nakhuyproject.github.io/akhueno-project/tonconnect-manifest.json'
        });

        tonClient.onStatusChange(async wallet => {
            if (wallet) {
                userAddress = wallet.account.address;
                walletAddressEl.textContent = userAddress;
                walletInfo.classList.add('active');
                await fetchJettonBalance(userAddress);
            } else {
                userAddress = null;
                walletInfo.classList.remove('active');
            }
        });

        await tonClient.restoreConnection();
    } catch (error) {
        console.error('TonConnect error:', error);
        showError('–û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫–æ—à–µ–ª—å–∫–∞. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞.');
    }
}

logoClickable.addEventListener('click', async () => {
    if (typeof window.Telegram !== 'undefined' && window.Telegram.WebApp) {
        window.Telegram.WebApp.expand();
    }
    await initializeTonConnect();
});

async function fetchJettonBalance(address) {
    try {
        tokenBalanceEl.textContent = '–ó–∞–≥—Ä—É–∑–∫–∞ –±–∞–ª–∞–Ω—Å–∞...';

        // –ü–æ–ª—É—á–∞–µ–º –∞–¥—Ä–µ—Å jetton-wallet –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        const response1 = await fetch(TON_CENTER_API, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
                jsonrpc: '2.0',
                id: 1,
                method: 'runGetMethod',
                params: {
                    address: JETTON_MASTER,
                    method: 'get_wallet_address',
                    stack: [{ type: 'slice', value: address }]
                }
            })
        });

        const data1 = await response1.json();
        if (!data1.result?.stack || data1.result.stack.length === 0) {
            tokenBalanceEl.textContent = '–ë–∞–ª–∞–Ω—Å: 0 NAKHUY';
            return;
        }

        const cellSlice = data1.result.stack[0];
        if (cellSlice.type !== 'cell_slice') {
            tokenBalanceEl.textContent = '–ë–∞–ª–∞–Ω—Å: 0 NAKHUY';
            return;
        }

        const addressBuffer = cellSlice.cell;
        const walletAddress = bufferToAddress(addressBuffer);
        if (!walletAddress) {
            tokenBalanceEl.textContent = '–ë–∞–ª–∞–Ω—Å: –æ—à–∏–±–∫–∞';
            return;
        }

        // –ü–æ–ª—É—á–∞–µ–º –±–∞–ª–∞–Ω—Å –∏–∑ jetton-wallet
        const response2 = await fetch(TON_CENTER_API, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
                jsonrpc: '2.0',
                id: 2,
                method: 'runGetMethod',
                params: {
                    address: walletAddress,
                    method: 'get_wallet_data',
                    stack: []
                }
            })
        });

        const data2 = await response2.json();
        if (!data2.result?.stack || data2.result.stack.length === 0) {
            tokenBalanceEl.textContent = '–ë–∞–ª–∞–Ω—Å: 0 NAKHUY';
            return;
        }

        const balanceStack = data2.result.stack[0];
        if (balanceStack.type !== 'int') {
            tokenBalanceEl.textContent = '–ë–∞–ª–∞–Ω—Å: 0 NAKHUY';
            return;
        }

        const balanceBigInt = BigInt(balanceStack.value);
        if (balanceBigInt === 0n) {
            tokenBalanceEl.textContent = '–ë–∞–ª–∞–Ω—Å: 0 NAKHUY';
            return;
        }

        const balanceNumber = Number(balanceBigInt) / 1e9;
        const formattedBalance = balanceNumber.toLocaleString(undefined, {
            minimumFractionDigits: 0,
            maximumFractionDigits: 9
        });
        tokenBalanceEl.textContent = `–ë–∞–ª–∞–Ω—Å: ${formattedBalance} NAKHUY`;
    } catch (error) {
        console.error('Balance fetch error:', error);
        tokenBalanceEl.textContent = '–ë–∞–ª–∞–Ω—Å: –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω';
    }
}

function bufferToAddress(cellBoc) {
    try {
        const binary = atob(cellBoc);
        const bytes = new Uint8Array(binary.length);
        for (let i = 0; i < binary.length; i++) {
            bytes[i] = binary.charCodeAt(i);
        }

        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–ª–∏–Ω—É (–º–∏–Ω–∏–º—É–º 34 –±–∞–π—Ç–∞ –¥–ª—è –∞–¥—Ä–µ—Å–∞)
        if (bytes.length < 34) {
            throw new Error('Invalid address length');
        }

        const workchain = bytes[0];
        const hashPart = bytes.slice(2, 34);

        let addressString = String.fromCharCode(workchain);
        for (let i = 0; i < hashPart.length; i++) {
            addressString += String.fromCharCode(hashPart[i]);
        }

        const base64Url = btoa(addressString)
            .replace(/\+/g, '-')
            .replace(/\//g, '_')
            .replace(/=/g, '');

        return 'EQ' + base64Url;
    } catch (error) {
        console.error('Address conversion error:', error);
        return null;
    }
}
</script>
</body>
</html>